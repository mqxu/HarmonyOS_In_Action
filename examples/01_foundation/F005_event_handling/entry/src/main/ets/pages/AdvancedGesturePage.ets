import { hilog } from '@kit.PerformanceAnalysisKit';

@Entry
@Component
struct AdvancedGesturePage {
  @State swipeDirection: string = 'æœªæ»‘åŠ¨';
  @State pinchScale: number = 1;
  @State rotationAngle: number = 0;

  private goBack(): void {
    this.getUIContext().getRouter().back();
  }

  build() {
    Column() {
      // é¡¶éƒ¨å¯¼èˆª
      Row() {
        Button('è¿”å›ž')
          .onClick(() => this.goBack())
          .backgroundColor($r('app.color.brand_primary'))

        Text('é«˜çº§æ‰‹åŠ¿')
          .fontSize(20)
          .fontWeight(FontWeight.Bold)
          .fontColor($r('app.color.text_primary'))
          .layoutWeight(1)
          .textAlign(TextAlign.Center)

        Button('è¿”å›ž')
          .visibility(Visibility.Hidden)
      }
      .width('100%')
      .padding(16)
      .backgroundColor($r('app.color.bg_primary'))

      Scroll() {
        Column({ space: 24 }) {
          // SwipeGesture æ»‘åŠ¨
          Column({ space: 12 }) {
            Text('1. SwipeGesture æ»‘åŠ¨æ‰‹åŠ¿')
              .fontSize(18)
              .fontWeight(FontWeight.Bold)
              .fontColor($r('app.color.text_primary'))

            Text(`æ»‘åŠ¨æ–¹å‘: ${this.swipeDirection}`)
              .fontSize(14)
              .fontColor($r('app.color.text_secondary'))

            Column() {
              Text('åœ¨è¿™é‡Œæ»‘åŠ¨')
                .fontSize(16)
                .fontColor($r('app.color.text_primary'))
              Text('(ä¸Š/ä¸‹/å·¦/å³)')
                .fontSize(12)
                .fontColor($r('app.color.text_tertiary'))
                .margin({ top: 8 })
            }
            .width('100%')
            .height(150)
            .backgroundColor($r('app.color.bg_hover'))
            .borderRadius(8)
            .justifyContent(FlexAlign.Center)
            .gesture(
              SwipeGesture({ fingers: 1, direction: SwipeDirection.All })
                .onAction((event: GestureEvent) => {
                  const angle: number = event.angle || 0;
                  if (angle > -45 && angle <= 45) {
                    this.swipeDirection = 'å‘å³æ»‘åŠ¨';
                  } else if (angle > 45 && angle <= 135) {
                    this.swipeDirection = 'å‘ä¸‹æ»‘åŠ¨';
                  } else if (angle > 135 || angle <= -135) {
                    this.swipeDirection = 'å‘å·¦æ»‘åŠ¨';
                  } else {
                    this.swipeDirection = 'å‘ä¸Šæ»‘åŠ¨';
                  }
                  hilog.info(0x0000, 'F005', `æ»‘åŠ¨è§’åº¦: ${angle}, æ–¹å‘: ${this.swipeDirection}`);
                })
            )
          }
          .width('100%')
          .padding(16)
          .backgroundColor($r('app.color.bg_primary'))
          .borderRadius(12)
          .alignItems(HorizontalAlign.Start)

          // PinchGesture æåˆ
          Column({ space: 12 }) {
            Text('2. PinchGesture æåˆæ‰‹åŠ¿')
              .fontSize(18)
              .fontWeight(FontWeight.Bold)
              .fontColor($r('app.color.text_primary'))

            Text(`ç¼©æ”¾æ¯”ä¾‹: ${this.pinchScale.toFixed(2)}x`)
              .fontSize(14)
              .fontColor($r('app.color.text_secondary'))

            Stack() {
              Column()
                .width('100%')
                .height(250)
                .backgroundColor($r('app.color.bg_hover'))
                .borderRadius(8)

              Column() {
                Text('ðŸ–¼ï¸')
                  .fontSize(48)
              }
              .width(100)
              .height(100)
              .backgroundColor($r('app.color.brand_primary'))
              .borderRadius(8)
              .justifyContent(FlexAlign.Center)
              .scale({ x: this.pinchScale, y: this.pinchScale })
              .gesture(
                PinchGesture({ fingers: 2 })
                  .onActionUpdate((event: GestureEvent) => {
                    if (event.scale !== undefined) {
                      this.pinchScale = event.scale;
                    }
                  })
                  .onActionEnd(() => {
                    hilog.info(0x0000, 'F005', `æœ€ç»ˆç¼©æ”¾: ${this.pinchScale}`);
                  })
              )
            }
            .width('100%')
            .height(250)
            .alignContent(Alignment.Center)

            Button('é‡ç½®ç¼©æ”¾')
              .width('100%')
              .backgroundColor($r('app.color.brand_success'))
              .onClick(() => {
                this.pinchScale = 1;
              })
          }
          .width('100%')
          .padding(16)
          .backgroundColor($r('app.color.bg_primary'))
          .borderRadius(12)
          .alignItems(HorizontalAlign.Start)

          // RotationGesture æ—‹è½¬
          Column({ space: 12 }) {
            Text('3. RotationGesture æ—‹è½¬æ‰‹åŠ¿')
              .fontSize(18)
              .fontWeight(FontWeight.Bold)
              .fontColor($r('app.color.text_primary'))

            Text(`æ—‹è½¬è§’åº¦: ${Math.round(this.rotationAngle)}Â°`)
              .fontSize(14)
              .fontColor($r('app.color.text_secondary'))

            Stack() {
              Column()
                .width('100%')
                .height(250)
                .backgroundColor($r('app.color.bg_hover'))
                .borderRadius(8)

              Column() {
                Text('â†‘')
                  .fontSize(32)
                  .fontWeight(FontWeight.Bold)
              }
              .width(100)
              .height(100)
              .backgroundColor($r('app.color.brand_warning'))
              .borderRadius(8)
              .justifyContent(FlexAlign.Center)
              .rotate({ angle: this.rotationAngle })
              .gesture(
                RotationGesture({ fingers: 2 })
                  .onActionUpdate((event: GestureEvent) => {
                    if (event.angle !== undefined) {
                      this.rotationAngle = event.angle;
                    }
                  })
                  .onActionEnd(() => {
                    hilog.info(0x0000, 'F005', `æœ€ç»ˆè§’åº¦: ${this.rotationAngle}`);
                  })
              )
            }
            .width('100%')
            .height(250)
            .alignContent(Alignment.Center)

            Button('é‡ç½®è§’åº¦')
              .width('100%')
              .backgroundColor($r('app.color.brand_success'))
              .onClick(() => {
                this.rotationAngle = 0;
              })
          }
          .width('100%')
          .padding(16)
          .backgroundColor($r('app.color.bg_primary'))
          .borderRadius(12)
          .alignItems(HorizontalAlign.Start)
        }
        .width('100%')
        .padding(16)
      }
      .layoutWeight(1)
    }
    .width('100%')
    .height('100%')
    .backgroundColor($r('app.color.bg_page'))
  }
}
