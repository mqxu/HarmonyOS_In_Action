import { ArticleCard } from '../components/ArticleCard';
import { Article } from '../models/Article';
import hilog from '@ohos.hilog';

@Entry
@Component
struct BuilderPage {
  @State article: Article = new Article(
    1,
    'é¸¿è’™å¼€å‘è¿›é˜¶ï¼šæ·±å…¥ç†è§£ @Builder å’Œ @BuilderParam',
    'æŠ€æœ¯ä¸“å®¶',
    'ðŸš€',
    '@Builder ç”¨äºŽåˆ›å»ºè½»é‡çº§çš„ UI æž„å»ºå‡½æ•°ï¼Œè€Œ @BuilderParam å…è®¸ç»„ä»¶æŽ¥æ”¶å¤–éƒ¨ä¼ å…¥çš„ UI æž„å»ºå‡½æ•°ï¼Œå®žçŽ°é«˜åº¦çš„UIå®šåˆ¶åŒ–ã€‚è¿™æ˜¯é¸¿è’™å¼€å‘ä¸­éžå¸¸é‡è¦çš„è¿›é˜¶æŠ€èƒ½...',
    ['Builder', 'BuilderParam', 'è¿›é˜¶'],
    512,
    96
  );

  @State useCustomHeader: boolean = false;
  @State useCustomFooter: boolean = false;

  /**
   * è¿”å›žä¸Šä¸€é¡µ
   */
  private goBack(): void {
    this.getUIContext().getRouter().back();
  }

  /**
   * è‡ªå®šä¹‰æ–‡ç« å¤´éƒ¨
   */
  @Builder
  customArticleHeader() {
    Row({ space: 8 }) {
      Image('ðŸ‘¤')
        .width(32)
        .height(32)
        .borderRadius(16)
        .backgroundColor($r('app.color.bg_secondary'))

      Column({ space: 2 }) {
        Text(this.article.author)
          .fontSize(14)
          .fontWeight(FontWeight.Bold)
          .fontColor($r('app.color.text_primary'))

        Text('ä¸“ä¸šæŠ€æœ¯åšä¸» Â· å·²å…³æ³¨')
          .fontSize(12)
          .fontColor($r('app.color.brand_primary'))
      }
      .alignItems(HorizontalAlign.Start)
    }
    .width('100%')
    .padding({ left: 16, right: 16, top: 12 })
  }

  /**
   * è‡ªå®šä¹‰æ–‡ç« åº•éƒ¨
   */
  @Builder
  customArticleFooter() {
    Column({ space: 8 }) {
      Row({ space: 12 }) {
        Button('ç‚¹èµž ðŸ‘')
          .fontSize(13)
          .backgroundColor($r('app.color.brand_primary'))
          .height(36)
          .layoutWeight(1)

        Button('è¯„è®º ðŸ’¬')
          .fontSize(13)
          .backgroundColor($r('app.color.bg_secondary'))
          .fontColor($r('app.color.text_primary'))
          .height(36)
          .layoutWeight(1)

        Button('åˆ†äº« ðŸ“¤')
          .fontSize(13)
          .backgroundColor($r('app.color.bg_secondary'))
          .fontColor($r('app.color.text_primary'))
          .height(36)
          .layoutWeight(1)
      }
      .width('100%')

      Row() {
        Text(`${this.article.likes} äººç‚¹èµž Â· ${this.article.comments} æ¡è¯„è®º`)
          .fontSize(12)
          .fontColor($r('app.color.text_tertiary'))
      }
      .width('100%')
    }
    .width('100%')
    .padding({ left: 16, right: 16, bottom: 12, top: 8 })
  }

  build() {
    Column() {
      // å¯¼èˆªæ 
      Row() {
        Text('â†')
          .fontSize(24)
          .fontColor($r('app.color.text_primary'))
          .onClick(() => {
            this.goBack()
          })

        Text('@Builder + @BuilderParam')
          .fontSize(18)
          .fontWeight(FontWeight.Bold)
          .fontColor($r('app.color.text_primary'))
          .margin({ left: 12 })
      }
      .width('100%')
      .height(56)
      .padding({ left: 16, right: 16 })
      .backgroundColor($r('app.color.bg_primary'))

      Scroll() {
        Column({ space: 24 }) {
          // è¯´æ˜Ž
          Column({ space: 8 }) {
            Text('è£…é¥°å™¨è¯´æ˜Ž')
              .fontSize(16)
              .fontWeight(FontWeight.Bold)
              .fontColor($r('app.color.text_primary'))

            Column({ space: 8 }) {
              this.ExplanationItem(
                '@Builder',
                'åˆ›å»ºè½»é‡çº§çš„ UI æž„å»ºå‡½æ•°ï¼Œå¯ä»¥åœ¨ç»„ä»¶å†…éƒ¨å®šä¹‰å¯å¤ç”¨çš„ UI ç‰‡æ®µ'
              )
              this.ExplanationItem(
                '@BuilderParam',
                'å…è®¸ç»„ä»¶æŽ¥æ”¶å¤–éƒ¨ä¼ å…¥çš„ Builder å‡½æ•°ï¼Œå®žçŽ° UI å†…å®¹çš„å®šåˆ¶åŒ–'
              )
            }

            Text('ä½¿ç”¨åœºæ™¯ï¼š')
              .fontSize(14)
              .fontWeight(FontWeight.Medium)
              .fontColor($r('app.color.text_primary'))
              .margin({ top: 12 })

            Column({ space: 4 }) {
              this.FeatureItem('ç»„ä»¶å†…éƒ¨çš„ UI å¤ç”¨ï¼ˆ@Builderï¼‰')
              this.FeatureItem('æä¾›é»˜è®¤ UI ä½†å…è®¸å®šåˆ¶ï¼ˆ@BuilderParamï¼‰')
              this.FeatureItem('å®žçŽ°æ’æ§½ï¼ˆSlotï¼‰ç±»ä¼¼çš„åŠŸèƒ½')
              this.FeatureItem('æž„å»ºå¤æ‚çš„å¯é…ç½®ç»„ä»¶')
            }
          }
          .width('100%')
          .padding(16)
          .backgroundColor($r('app.color.bg_primary'))
          .borderRadius(8)

          // å®žæ—¶é¢„è§ˆ
          Column({ space: 12 }) {
            Text('å®žæ—¶é¢„è§ˆ')
              .fontSize(16)
              .fontWeight(FontWeight.Bold)
              .fontColor($r('app.color.text_primary'))

            // æ ¹æ®å¼€å…³æ˜¾ç¤ºä¸åŒçš„æ–‡ç« å¡ç‰‡
            if (this.useCustomHeader && this.useCustomFooter) {
              ArticleCard({
                article: this.article,
                customHeader: () => {
                  this.customArticleHeader()
                },
                customFooter: () => {
                  this.customArticleFooter()
                }
              })
            } else if (this.useCustomHeader) {
              ArticleCard({
                article: this.article,
                customHeader: () => {
                  this.customArticleHeader()
                }
              })
            } else if (this.useCustomFooter) {
              ArticleCard({
                article: this.article,
                customFooter: () => {
                  this.customArticleFooter()
                }
              })
            } else {
              ArticleCard({ article: this.article })
            }
          }
          .width('100%')

          // æŽ§åˆ¶é¢æ¿
          Column({ space: 16 }) {
            Text('å®šåˆ¶æŽ§åˆ¶')
              .fontSize(16)
              .fontWeight(FontWeight.Bold)
              .fontColor($r('app.color.text_primary'))

            // è‡ªå®šä¹‰å¤´éƒ¨
            Row() {
              Text('ä½¿ç”¨è‡ªå®šä¹‰å¤´éƒ¨')
                .fontSize(14)
                .fontColor($r('app.color.text_secondary'))
              Blank()
              Toggle({ type: ToggleType.Switch, isOn: this.useCustomHeader })
                .selectedColor($r('app.color.brand_primary'))
                .onChange((isOn: boolean) => {
                  this.useCustomHeader = isOn;
                })
            }
            .width('100%')

            // è‡ªå®šä¹‰åº•éƒ¨
            Row() {
              Text('ä½¿ç”¨è‡ªå®šä¹‰åº•éƒ¨')
                .fontSize(14)
                .fontColor($r('app.color.text_secondary'))
              Blank()
              Toggle({ type: ToggleType.Switch, isOn: this.useCustomFooter })
                .selectedColor($r('app.color.brand_primary'))
                .onChange((isOn: boolean) => {
                  this.useCustomFooter = isOn;
                })
            }
            .width('100%')
          }
          .width('100%')
          .padding(16)
          .backgroundColor($r('app.color.bg_primary'))
          .borderRadius(8)

          // ä»£ç ç¤ºä¾‹
          Column({ space: 8 }) {
            Text('ä»£ç ç¤ºä¾‹')
              .fontSize(16)
              .fontWeight(FontWeight.Bold)
              .fontColor($r('app.color.text_primary'))

            Text(`// å®šä¹‰ Builder\n@Builder\ncustomHeader() {\n  // UI å†…å®¹\n}\n\n// ä½¿ç”¨ BuilderParam\nArticleCard({\n  article: article,\n  customHeader: () => {\n    this.customHeader()\n  }\n})`)
              .fontSize(12)
              .fontFamily('monospace')
              .fontColor($r('app.color.text_secondary'))
              .padding(12)
              .backgroundColor($r('app.color.bg_secondary'))
              .borderRadius(4)
              .width('100%')
          }
          .width('100%')
        }
        .padding(16)
      }
      .layoutWeight(1)
      .backgroundColor($r('app.color.bg_secondary'))
    }
    .width('100%')
    .height('100%')
  }

  @Builder
  FeatureItem(text: string) {
    Row({ space: 8 }) {
      Text('â€¢')
        .fontSize(14)
        .fontColor($r('app.color.brand_primary'))
      Text(text)
        .fontSize(13)
        .fontColor($r('app.color.text_secondary'))
    }
  }

  @Builder
  ExplanationItem(title: string, description: string) {
    Column({ space: 4 }) {
      Text(title)
        .fontSize(14)
        .fontWeight(FontWeight.Medium)
        .fontColor($r('app.color.brand_primary'))

      Text(description)
        .fontSize(13)
        .fontColor($r('app.color.text_secondary'))
        .lineHeight(20)
    }
    .alignItems(HorizontalAlign.Start)
    .width('100%')
    .padding(12)
    .backgroundColor($r('app.color.bg_secondary'))
    .borderRadius(4)
  }
}
